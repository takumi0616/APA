# タスク（プロンプト）を行う前に必ず以下の資料を読んでください

この資料は環境がどう構築されたかを記しておりコマンド実行などの際は必ず参考にしてください
@/git_installation_guide.md
@/miniconda_installation_guide.md

自分の大まかな目標ややっていることの概要については以下を確認してください
@/APA\document\plan\claude_plan.md
@/APA\document\plan\gpt_plan.md
内容は参考程度にしてください

タスクを行った際は、タスク成功後に、行ったことをマークダウン記法でまとめたものを@/APA\document\report の中にファイルを作成してください
ファイル名のルール：番号_年月日_行ったことを日本語.md（例：1_20260106_環境構築）
番号は@/APA\document\report の中を精査して確認してください
これまでのreportも読み込んでからタスクを行ってください
---
# プロンプト

以下の手順を丁寧に守っているプログラムを作成してください

./image/A（および./image/B）

追加で./image/A、./image/B、./image/Cの画像をすべて持ってきて、それに対して画像に対して改悪処理をする（参考プログラム：@/APA\test_recovery_paper.pyの実装を使う）

今後、改悪処理した画像1枚に対して以下の処理を行い、すべての改悪画像に以下の処理を適用していく
---
改悪処理後の画像に対してDocAlignerを行う（紙を囲う四角の枠が得られる）（参考プログラム：@/APAAPA\test_docaligner_camera_v3.py ）
四角の枠を得られなかったら処理終了

その枠の中において、以下の処理を同時に行う
- フォームAの様式の確認を画像を回転（360度）させたものを平行処理で検出を行う（参考プログラム：@/APA\test_capture_formA.py ）
- フォームBの様式の確認を画像を回転（360度）させたものを平行処理で検出を行う（参考プログラム：@/APA\test_capture_formB.py ）
- 条件通りのフォーム(Aであれば左上、右上、左下に3点マーク。Bであれば右上にQRコード。短い片が横側、長い片が上下に来るようなもの)を探し出す
- 確定したら以下の処理を行う（確定しなければ処理終了）

もし様式確認でA確定したなら
- 改悪画像とAのテンプレ全て（./image/Aの中の画像全て）を、それぞれXFeat matchingによる位置合わせ（Homography 推定）作業を行う、それぞれで出た一致度（対応点の一致数）を比較し、一番高いものを採用
もし様式確認でB確定したなら
- 改悪画像とBのテンプレ全て（./image/Bの中の画像全て）を、それぞれXFeat matchingによる位置合わせ（Homography 推定）作業を行う、それぞれで出た一致度（対応点の一致数）を比較し、一番高いものを採用
（参考プログラム：@/APAAPA\test_recovery_paper.py ）

一番高いものを採用してwarpedの画像を作成
---