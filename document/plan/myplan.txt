# 改訂版 memo（整理・清書）

目的：
カメラ映像から紙フォームを検出し、フォーム種別（A/B/その他）を判定したうえで、テンプレートに対して自動補正しリアルタイム表示する。

前提：
・リアルタイム処理はCPU中心（軽量優先）

--------------------------------------------
1. 入力（リアルタイム）
--------------------------------------------
- カメラからフレームを連続取得
- 事前にレンズ歪み補正（undistort）を適用（精度・見栄え向上）


--------------------------------------------
2. 検出フェーズ（軽量・頑健）
--------------------------------------------
(2-1) 紙検出（優先）
- 輪郭検出・直線検出などで「紙らしい四角形」を推定
- 紙候補を得る

(2-2)  紙検出部分からQR / マーカー検出（A or B or etc...）
- QRコードやマーカーを高速に探索
- 検出を判定

（理由）
カメラ全画面からQRやマーカーを認識するのは非常に誤検出のリスクがある
また、用紙のフォーム別検出に関する豊富なデータや先行研究モデルもないことから、背景込みから特定の模様や特徴を探すのは困難と判断
しかし、紙の検出であれば先行研究モデルが存在している


--------------------------------------------
3. フォーム種別判定（A/B/その他：ここは追加可能なようにモジュール実装）
--------------------------------------------
- フォームA：マーカー（例：正方形マーカー）で識別
- フォームB：QRコードで識別
- その他：必要に応じた識別方法（ロゴ等）

※基本方針：
フォームの変更は絶対に不可
「識別できた特徴点（QR四隅／マーカー角点など）を、整列用の対応点として使える形で保持する」


--------------------------------------------
4. 補正画像の生成
--------------------------------------------
- 1フレームの画像、それに対して
  - 紙検出時の四角形ボックス
  - モジュールの抽出された特徴点情報
が得られるので...

(4-1) 位置合わせ（Homography）
- フレームで Homography を推定
  - もしくは「追跡」で更新し、安定なワープを得る
- テンプレ座標系へ warp（透視変換）した画像を蓄積する
- 紙のたわみや角度的なずれをここで改善

(4-2) 画像の品質改善
- ブラー（ピンぼけ/手ブレ）改善
- ノイズ除去
- 文字化け改善（2値化等）
- 影の改善（照明ムラ補正）
- 汚れ・しみ補正
etc...

完璧にきれいにする


--------------------------------------------
5. 表示
--------------------------------------------
- 補正された画像を標準形式でリアルタイム表示
- メタ情報も表示（フォームID、スコア、検出成功率、処理時間など）

↓

OCR作業へ（担当外）
